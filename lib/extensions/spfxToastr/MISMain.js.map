{"version":3,"sources":["extensions/spfxToastr/MISMain.ts"],"names":[],"mappings":"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","file":"extensions/spfxToastr/MISMain.js","sourcesContent":["import { SPHttpClient, SPHttpClientResponse } from '@microsoft/sp-http';\nimport { MISGlobalNavigation } from './MISGlobalNavigation';\n\nexport class MISMain {\n\n  public listGUID: any;\n  public navigationType: any; //'Menu' or 'Wiki'\n  public termStoreGUID: any; // = _termStoreGUID,\n  public termStoreName: any; // = _termStoreName,//Service de métadonnées gérées\n  public homeBtnTitle: any;\n  public homeBtnUrl: any;\n  public isCentralResource: any;\n  public spcontext: any;\n\n  constructor(_spcontext: any) {\n    this.spcontext = _spcontext;\n    this.listGUID = null;\n    this.navigationType = null;\n    this.termStoreGUID = null;\n    this.termStoreName = null;\n    this.homeBtnTitle = null;\n    this.homeBtnUrl = null;\n    this.isCentralResource = null;\n\n    try {\n      //Contain the webapp where mysites is configured\n      var privateUrl = \"https://private.monacoinformatiqueservice.mc\";\n      this.getMenuParameters();\n      //SP.SOD.executeOrDelayUntilScriptLoaded(MIS.SiteCollection.execute, \"sp.ui.pub.ribbon.js\");\n    } catch (ex) {\n      //////console.log(\"$(document).ready\" + ex);\n      if (typeof console === \"object\") {\n        ////console.log(\"$(document).ready\" + ex);\n      } else {\n        alert(\"$(document).ready\" + ex);\n      }\n    }\n  }\n\n  //public static init(spcontext: any, _termStoreName: any, _termStoreGUID: any) {\n  private getMenuParameters(): void {\n    ////console.log(\"getMenuParameters called\");\n\n    try {\n      this.loadSessionStorage;\n      if (this.termStoreGUID == undefined && this.termStoreName == undefined) {\n        //var url = _spPageContextInfo.webAbsoluteUrl;\n        var url = (this.spcontext.pageContext.web.absoluteUrl == \"/\") ? \"\" : this.spcontext.pageContext.web.absoluteUrl;\n        //debugger\n        this.getSettingsData(url).then(() => {\n          //debugger\n          ////console.log(\"then getSettingsData\");\n          ////console.log(\"isCentralresource value \" + this.isCentralResource);\n          ////console.log(\"termStoreName value \" + this.termStoreName);\n\n          //Insert the menu in the top navigation\n          this.insertMenu();\n\n          //if (this.isCentralResource == true && url != this.homeBtnUrl) {\n          //  this.getSettingsData(this.homeBtnUrl); //Call GlobalNavigation settings data in the Central ressource url\n          //}\n        }); //Call GlobalNavigation settings data\n      }\n    } catch (e) {\n      if (typeof console === \"object\") {\n        ////console.log(\"getMenuParameters function:\" + e);\n      }\n    }\n  }\n  /**\n   * Load data from List GlobalNavigation URL and update the sessionStorage\n   *\n   */\n  private getSettingsData(url): Promise<void> {\n\n    return new Promise<void>((resolve, reject) => {\n\n      ////console.log(\"gettingsData function called\");\n\n      try {\n        var requestUri = url + \"/_api/web/lists/getByTitle('GlobalNavigation')/Items?$filter=isActif eq 1\";\n        ////console.log(requestUri);\n        // execute AJAX request synchrone\n        //debugger;\n        let thisGlobal = this;\n        //debugger\n        $.ajax({\n          url: requestUri,\n          type: \"GET\",\n          headers: {\n            \"ACCEPT\": \"application/json;odata=verbose\"\n          },\n          success: function (data) {\n            ////debugger\n            ////console.log(data);\n            //debugger;\n            //debugger\n            if (data.d.results.length > 0) {\n\n              thisGlobal.listGUID = data.d.results[0].ListGUID;\n              thisGlobal.navigationType = data.d.results[0].NavigationType;\n              thisGlobal.termStoreName = data.d.results[0].TermStoreName;\n              ////console.log(\"1- set termstoreName with value \" + data.d.results[0].TermStoreName)\n              if (thisGlobal.termStoreName == null) {\n                console.error(\"ERROR, the function getSettingsData did nto return the term store name from global nav list ! Did you deploy global nav list ?\")\n              }\n\n              thisGlobal.termStoreGUID = data.d.results[0].TermStoreGUID;\n              thisGlobal.homeBtnTitle = data.d.results[0].HomeBtnTitle;\n              thisGlobal.homeBtnUrl = data.d.results[0].HomeBtnUrl;\n              thisGlobal.isCentralResource = data.d.results[0].CentralResource;\n              //Backup Data in session.Storage\n              sessionStorage.setItem(\"listGUID\", thisGlobal.listGUID);\n              sessionStorage.setItem(\"navigationType\", thisGlobal.navigationType);\n              sessionStorage.setItem(\"termStoreName\", thisGlobal.termStoreName);\n              sessionStorage.setItem(\"termStoreGUID\", thisGlobal.termStoreGUID);\n              sessionStorage.setItem(\"homeBtnTitle\", thisGlobal.homeBtnTitle);\n              sessionStorage.setItem(\"homeBtnUrl\", thisGlobal.homeBtnUrl);\n              sessionStorage.setItem(\"isCentralResource\", thisGlobal.isCentralResource);\n              resolve();\n            }else {\n              throw new Error(\"Cant read settings from global navigation list\");\n            }\n          },\n          error: function (err) {\n            //debugger\n            if (typeof console === \"object\") {\n              ////console.log(\"getSettingsData - ajax :\" + err);\n            }\n            resolve();\n          }\n        });\n      } catch (e) {\n        if (typeof console === \"object\") {\n          //console.log(\"getSettingsData function:\" + e);\n        }\n        reject();\n      }\n    });\n  }\n  /**\n   * Load data from sessionStorage\n   *\n   */\n  private loadSessionStorage(): void {\n    if (typeof (Storage) !== \"undefined\") {\n      if (sessionStorage.termStoreGUID) {\n        this.termStoreGUID = sessionStorage.getItem(\"termStoreGUID\");\n      }\n      if (sessionStorage.termStoreName) {\n        this.termStoreName = sessionStorage.getItem(\"termStoreName\");\n      }\n      if (sessionStorage.navigationType) {\n        this.navigationType = sessionStorage.getItem(\"navigationType\");\n      }\n      if (sessionStorage.listGUID) {\n        this.listGUID = sessionStorage.getItem(\"listGUID\");\n      }\n      if (sessionStorage.homeBtnTitle) {\n        this.homeBtnTitle = sessionStorage.getItem(\"homeBtnTitle\");\n      }\n      if (sessionStorage.homeBtnUrl) {\n        this.homeBtnUrl = sessionStorage.getItem(\"homeBtnUrl\");\n      }\n      if (sessionStorage.isCentralResource) {\n        this.isCentralResource = sessionStorage.getItem(\"isCentralResource\");\n      }\n    } else {\n      // Sorry! No Web Storage support..\n      if (typeof console === \"object\") {\n        ////console.log(\"Sorry! No Web Storage support..\");\n      }\n    }\n  }\n\n  private insertMenu(): void {\n    ////console.log(\"insertMenu called\");\n    var siteUrl = \"\";\n    if (this.isCentralResource == \"true\") {\n      siteUrl = this.homeBtnUrl;\n    } else {\n      siteUrl = (this.spcontext.pageContext.web.absoluteUrl == \"/\") ? \"\" : this.spcontext.pageContext.web.absoluteUrl;\n    }\n\n    //debugger\n    switch (this.navigationType) {\n      case \"Menu\":\n        //Load the CSS Style sheet file of the project\n        //$('head').append(\"<link rel='stylesheet' type='text/css' href='\" + siteUrl + \"/Style Library/MIS.GlobalNavigation/css/MIS.GlobalNavigation.css'> </link>\");\n\n        //Load the Global Navigation\n        //debugger;\n        let MISGlobalNavigationObject:MISGlobalNavigation = new MISGlobalNavigation(siteUrl);\n        MISGlobalNavigationObject.init(this.spcontext, this.termStoreName, this.termStoreGUID);\n        //init(termStoreName, termStoreGUID);//Global Navigation\n        break;\n      default: //Error in the configuration, nothing is done\n    }\n  }\n\n  //});\n  // }\n}\n"],"sourceRoot":"..\\..\\..\\src"}